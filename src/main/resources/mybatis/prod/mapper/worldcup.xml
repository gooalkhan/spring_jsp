<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.spring_jsp.worldcup.WorldCupMapper">
	<update id="createTable">
		CREATE TABLE worldcuptbl (
		  IDX int NOT NULL AUTO_INCREMENT,
		  SUBJECT varchar(100) NOT NULL,
		  CONTENT varchar(200) NOT NULL,
		  membertbl_ID varchar(20) NOT NULL,
		  PRIMARY KEY (IDX),
		  KEY fk_worldcuptbl_membertbl1_idx (membertbl_ID),
		  CONSTRAINT fk_worldcuptbl_membertbl1 FOREIGN KEY (membertbl_ID) REFERENCES membertbl (ID)
		) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
    </update>

    <update id="dropTable">
        drop table if exists worldcuptbl;
    </update>
    
    
    
    
    
    
    
    <!-- 월드컵 인서트 -->
    <insert id="worldCupInsert" useGeneratedKeys="true" keyProperty="idx">
    	insert
    	into
    	worldcuptbl
    	(SUBJECT, CONTENT, membertbl_ID)
    	values
    	(#{subject}, #{content}, #{membertbl_id})
    </insert>
    
    <!-- 월드컵 이미지 인서트 -->
    <insert id="worldCupImageInsert">
    	insert
    	into
    	worldcupimagetbl
    	(ORIGINIMAGENAME, IMAGENAME, IMAGEPATH, worldcuptbl_IDX)
    	values
    	(#{originImageName}, #{imageName}, #{imagePath}, #{worldcuptbl_idx})
    </insert>
    
    <!-- 월드컵 삭제 -->
    <delete id="worldCupDelete">
		delete
		from
		worldcuptbl
		where
		IDX = #{idx}
	</delete>
	
	<!-- 월드컵 select -->
	<select id="worldCupSelect" resultType="com.example.spring_jsp.worldcup.WorldCupDTO">
		select
		*
		from
		worldcuptbl
	</select>
	
	<!-- 월드컵 이미지 select -->
	<select id="worldCupImageSelect" resultType="com.example.spring_jsp.worldcup.WorldCupDTO">
		SELECT
		worldcuptbl_IDX, MAX(IMAGENAME) AS IMAGENAME
		FROM
		worldcupimagetbl
		WHERE
		worldcuptbl_IDX BETWEEN 1 AND (select count(*) from worldcuptbl)
		GROUP BY worldcuptbl_IDX;
	</select>
</mapper>